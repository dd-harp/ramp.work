<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Scaling Relationships for Malaria Metrics • ramp.work</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Scaling Relationships for Malaria Metrics">
<meta property="og:description" content="ramp.work">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ramp.work</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Scaling.html">Scaling</a>
    </li>
    <li>
      <a href="../articles/Seasonality.html">Seasonality</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/dd-harp/ramp.xds/" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Scaling Relationships for Malaria Metrics</h1>
            
            <h4 data-toc-skip class="date">January 28, 2025</h4>
      
      
      <div class="hidden name"><code>Scaling.Rmd</code></div>

    </div>

    
    
<hr>
<p>Also see <a href="https://faculty.washington.edu/smitdave/simba/_site/index.html" class="external-link"><strong>SimBA</strong></a></p>
<hr>
<p>Load the required packages:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dd-harp.github.io/ramp.xds/">ramp.xds</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">ramp.work</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://desolve.r-forge.r-project.org/" class="external-link">deSolve</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridisLite/" class="external-link">viridisLite</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Loading <span style="color: #0000BB;">ramp.work</span></span></span></code></pre>
<p>An important question in malaria is the relationship between various
metrics, especially the relationships between mosquito density, the
annual entomological inoculation rate (aEIR), the parasite rate (PR),
and malaria reproductive numbers. To facilitate analysis of malaria
data, we have developed some functions to compute scaling relationships.
These are some of the key algorithms we use to generate malaria
intelligence assets, and we have two versions:</p>
<ul>
<li><p><code>xde_scaling_eir</code> uses the cohort functions in
<strong><code>ramp.xds.</code></strong> These cohort functions have some
advantages in working with exposure in a multiple cohorts as they age,
exposed to a common EIR signal.</p></li>
<li><p><code>xde_scaling_lambda</code> uses <code>xde_solve</code> in
<strong><code>ramp.xds.</code></strong> These use the trivial
<strong>L</strong>-component module to force emergence, and they examine
the relationship between mosquito density and all the other
metrics.</p></li>
</ul>
<div class="section level2">
<h2 id="xde_scaling_eir">xde_scaling_eir<a class="anchor" aria-label="anchor" href="#xde_scaling_eir"></a>
</h2>
<p>The function <code><a href="../reference/xde_scaling_eir.html">xde_scaling_eir()</a></code> defines the relationship
between the EIR and the PR. It analyzes stable orbits and outputs the
average annual EIR and average annual PR for an even mesh of
<code>log(aEIR)</code> values running from <span class="math inline">\(10^{-1}\)</span> up to <span class="math inline">\(10^{3}\)</span> The code is in
<code>mob_library/Work</code></p>
<p>To illustrate, we pick a function describing a seasonal pattern using
<code>ramp.xds::make_F_sin</code></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">730</span>, by<span class="op">=</span><span class="fl">5</span><span class="op">)</span> </span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dd-harp.github.io/ramp.xds/reference/makepar_F_sin.html">makepar_F_sin</a></span><span class="op">(</span>floor<span class="op">=</span><span class="fl">0.2</span>, pw<span class="op">=</span><span class="fl">1.2</span><span class="op">)</span></span>
<span><span class="va">Fsin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dd-harp.github.io/ramp.xds/reference/make_function.html">make_function</a></span><span class="op">(</span><span class="va">p1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tt</span>, <span class="fu">Fsin</span><span class="op">(</span><span class="va">tt</span><span class="op">)</span>, type<span class="op">=</span><span class="st">"l"</span>, xlab <span class="op">=</span> <span class="st">"Time (Days)"</span>, ylab <span class="op">=</span> <span class="st">"Seasonal Pattern"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Scaling_files/figure-html/Fsin-1.png" width="672"></p>
<p>Next, we set up a cohort model:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dd-harp.github.io/ramp.xds/reference/xds_setup_cohort.html">xds_setup_cohort</a></span><span class="op">(</span>Xname <span class="op">=</span> <span class="st">"SIS"</span>, F_season<span class="op">=</span><span class="va">Fsin</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">sis</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dd-harp.github.io/ramp.xds/reference/xds_solve_cohort.html">xds_solve_cohort</a></span><span class="op">(</span><span class="va">sis</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">sis</span></span></code></pre></div>
<p>The function <code>xde_scaling_eir</code> runs the model over a mesh
of <code>N=25</code> values:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/xde_scaling_eir.html">xde_scaling_eir</a></span><span class="op">(</span><span class="va">sis</span>, <span class="fl">25</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">sis</span></span></code></pre></div>
<p>The results are attached as <code>sis$outputs$eirpr</code></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_eirpr.html">plot_eirpr</a></span><span class="op">(</span><span class="va">sis</span><span class="op">)</span></span></code></pre></div>
<p><img src="Scaling_files/figure-html/unnamed-chunk-6-1.png" width="672"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/eirpr_seasonal_profile.html">eirpr_seasonal_profile</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">10</span>,<span class="fl">15</span>,<span class="fl">20</span><span class="op">)</span>, <span class="va">sis</span>, clrs <span class="op">=</span> <span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">turbo</a></span><span class="op">(</span><span class="fl">25</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Scaling_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="xde_scaling_lambda">xde_scaling_lambda<a class="anchor" aria-label="anchor" href="#xde_scaling_lambda"></a>
</h2>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Lo</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  F_season <span class="op">=</span> <span class="va">Fsin</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dd-harp.github.io/ramp.xds/reference/xds_setup.html">xds_setup</a></span><span class="op">(</span>Xname <span class="op">=</span> <span class="st">"SIS"</span>, Lopts <span class="op">=</span> <span class="va">Lo</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">sis_full</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dd-harp.github.io/ramp.xds/reference/xds_solve.html">xds_solve</a></span><span class="op">(</span><span class="va">sis_full</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">sis_full</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/load_all.html" class="external-link">load_all</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Loading <span style="color: #0000BB;">ramp.work</span></span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/xde_scaling_lambda.html">xde_scaling_lambda</a></span><span class="op">(</span><span class="va">sis_full</span>, <span class="fl">1.1</span>, <span class="fl">30</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">sis_full</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_eirpr.html">plot_eirpr</a></span><span class="op">(</span><span class="va">sis_full</span><span class="op">)</span></span></code></pre></div>
<p><img src="Scaling_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="xde_pr2eir">
<code>xde_pr2eir()</code><a class="anchor" aria-label="anchor" href="#xde_pr2eir"></a>
</h2>
<p>Since <code>xde_scaling</code> defines the relationship between the
EIR and the PR, we can now run <code><a href="../reference/xde_pr2eir.html">xde_pr2eir()</a></code> to get the
predicted value of the eir, for any given value of the pr. The code is
in <code>mob_library/Work</code></p>
<p>We can run this for 50 randomly chosen values of the
<em>Pf</em>PR.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">preir_i</span> <span class="op">=</span> <span class="fu"><a href="../reference/xde_pr2eir.html">xde_pr2eir</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.001</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fl">0.999</span><span class="op">)</span>, <span class="va">sis</span><span class="op">)</span></span></code></pre></div>
<p>The function flags any values that are outside of the acceptable
range. This may not seem important for the SIS model, but the range of
other models can be bounded, so we don’t want to return nonsense
values.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">preir_i</span><span class="op">$</span><span class="va">errors</span></span></code></pre></div>
<pre><code><span><span class="co">##         pr1         pr2         pr3 </span></span>
<span><span class="co">## 0.001000000 0.007399441 0.999000000</span></span></code></pre>
<p>We can plot the others:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_eirpr.html">plot_eirpr</a></span><span class="op">(</span><span class="va">sis</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">sis</span><span class="op">$</span><span class="va">outputs</span><span class="op">$</span><span class="va">eirpr</span>, <span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">aeir</span>, <span class="va">pr</span>, pch <span class="op">=</span> <span class="fl">15</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">preir_i</span>, <span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fl">365</span><span class="op">*</span><span class="va">eir</span>, <span class="va">pr</span>, pch <span class="op">=</span> <span class="fl">19</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Scaling_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by David L. Smith.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
