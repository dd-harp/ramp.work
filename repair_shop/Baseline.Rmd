---
title: "Imputing a Baseline"
output: html_document
---

The `impute_baseline` function replaces some subset of control points with new values. It was designed for use in a variety of applications. These functions use information for the `fitting` model object, accessed as `model$fitting`. That information is translated into context by `class(fitting)` for `setup_fitting` 



## Impute Baseline 

+ This is set up to modify an inter-annual pattern generated by a spline function.  


```{r impute_baseline}
#' @title Impute the Baseline
#'  
#' @description Modify some of the control points to impute a baseline value
#' from context.
#' 
#' @param ix the index of the knots for the control points to modify 
#' @param model a **`ramp.xds`** model object  
#' @param method the method to use for imputation: *e.g.* mean, median, ... 
#' @param include_rule the rule for selecting knots: *e.g.*  
#'
#' @returns a **`ramp.xds`** model object  
#'
#' @export
impute_baseline = function(ix, model, method="mean", include_rule="nix"){
  
  N = length(ix)
  
  class(include_rule) <- include_rule
  model$fitting$include_rule = include_rule
  yy_use <- get_trusted_yy(ix, model, include_rule) 
  
  class(method) <- method
  model$fitting$method = method
  yy_new <- make_new_yy(length(ix), yy_use, method) 

  model  <- change_yy(ix, yy_new, model)
  
  return(model)
}
```

```{r get_trusted_points, eval=F}
get_trusted_yy = function(ix, model, include_rule){
  UseMethod("get_trusted_yy ", include_rule) 
  return(list(tt=tt, yy=yy)) 
}
```

```{r change_control_points, eval=F}
change_control_points = function(ix, yy_new, model){
  model$fitting$data$cp[ix] <- yy_new
}
  
```
## Forecast 



In developing `use_control_points`, we wanted flexibility in the method for choosing some subset of fitted control points 

+ use the values of knots in the complement: `yy[-ix]`

+ use only the values of knots in past 

+ use only the values of knots that are unaffected by control, returning an appropriate value if no knots are unaffected by control



```{r}
use_control_points = function(ix, model, include_rule){
  UseMethod("use_control_points", model$fitting$include_rule)
}
```


